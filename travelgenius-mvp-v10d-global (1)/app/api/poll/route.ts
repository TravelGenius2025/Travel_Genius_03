import { NextResponse } from 'next/server'; import { getAdminClient } from '@/lib/supabaseAdmin'
export async function POST(req:Request){ const admin=getAdminClient(); if(!admin) return NextResponse.json({error:'Supabase not configured'},{status:501}); const body=await req.json().catch(()=>({})); const { title, options } = body||{}; if(!title||!Array.isArray(options)||options.length===0) return NextResponse.json({error:'Invalid payload'},{status:400}); const { data: poll, error }=await admin.from('polls').insert({title}).select().single(); if(error) return NextResponse.json({error:error.message},{status:500}); const rows=options.map((text:string)=>({poll_id:poll.id,text})); const { error:e2 }=await admin.from('poll_options').insert(rows); if(e2) return NextResponse.json({error:e2.message},{status:500}); return NextResponse.json({ id: poll.id }) }
